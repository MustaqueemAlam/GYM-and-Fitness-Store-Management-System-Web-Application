<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Red Theme</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="flex h-screen bg-gradient-to-r from-red-50 to-red-100">
<!-- Sidebar -->
<aside class="w-64 bg-white border-r border-gray-200 p-5 flex flex-col justify-between">
  <div>
    <!-- Logo + Title -->
    <div class="flex items-center gap-3 mb-8">
      <img src="https://cdn.pixabay.com/photo/2014/03/25/16/25/gym-297059_640.png" alt="Gym Logo" class="w-10 h-10 rounded-full object-cover shadow-md" />
      <h2 class="text-2xl font-bold text-red-700">E-Fitness Admin</h2>
    </div>

    <!-- Navigation -->
    <nav class="flex flex-col space-y-3">
      <a href="#" class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M13 5v6h6" />
        </svg>
        Dashboard
      </a>
      <a href="#" class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14v7" />
        </svg>
        Users
      </a>
      <a href="admin-subs-plan.html" class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-3.333 0-6 2-6 4s2.667 4 6 4 6-2 6-4-2.667-4-6-4z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 12v8" />
        </svg>
        Subscription Plans
      </a>
      <a href="#" class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 14l-2-2 4-4 6 6-2 2" />
        </svg>
        Payments
      </a>
      <a href="#" class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2a4 4 0 014-4h4" />
        </svg>
        Reports
      </a>
    </nav>
  </div>

  <!-- Logout Button pinned bottom -->
  <button class="mt-10 bg-red-100 hover:bg-red-200 text-red-700 font-semibold py-2 px-4 rounded transition-colors self-start">
    <svg xmlns="http://www.w3.org/2000/svg" class="inline w-5 h-5 mr-2 -mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1" />
    </svg>
    Logout
  </button>
</aside>

<main class="flex-1 p-6 flex flex-col gap-6 overflow-y-auto">
  <!-- Tabs for User Type -->
  <div class="flex gap-4">
    <button onclick="showTab(event, 'trainers')" class="tab-btn bg-red-200 px-4 py-2 rounded font-medium text-red-900">Trainers</button>
    <button onclick="showTab(event, 'clients')" class="tab-btn bg-red-200 px-4 py-2 rounded font-medium text-red-900">Clients</button>
    <button onclick="showTab(event, 'admins')" class="tab-btn bg-red-200 px-4 py-2 rounded font-medium text-red-900">Admins</button>
  </div>

  <!-- Trainers Tab -->
  <div id="trainersTab" class="user-tab">
    <h2 class="text-xl font-bold mt-6 mb-2">Trainers</h2>
    <button onclick="openModal('trainerModal')" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded mb-4">+ Add Trainer</button>
    <div class="overflow-x-auto">
      <table class="w-full bg-white shadow-md rounded-lg overflow-hidden text-sm">
        <thead class="bg-red-200 text-red-900">
          <tr>
            <th class="px-4 py-2">ID</th>
            <th class="px-4 py-2">Profile</th>
            <th class="px-4 py-2">Name</th>
            <th class="px-4 py-2">Email</th>
            <th class="px-4 py-2">Phone</th>
            <th class="px-4 py-2">Gender</th>
            <th class="px-4 py-2">DOB</th>
            <th class="px-4 py-2">City</th>
            <th class="px-4 py-2">Country</th>
            <th class="px-4 py-2">Qualifications</th>
            <th class="px-4 py-2">Expertise</th>
            <th class="px-4 py-2">Intro Video</th>
            <th class="px-4 py-2">Cert Title</th>
            <th class="px-4 py-2">Cert Issuer</th>
            <th class="px-4 py-2">Cert Year</th>
            <th class="px-4 py-2">Cert ID</th>
            <th class="px-4 py-2">Date Joined</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody id="trainersTable">
          <!-- Trainer rows go here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Clients Tab -->
  <div id="clientsTab" class="user-tab hidden">
    <h2 class="text-xl font-bold mt-6 mb-2">Clients</h2>
    <button onclick="openModal('clientModal')" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded mb-4">+ Add Client</button>
    <div class="overflow-x-auto">
      <table class="w-full bg-white shadow-md rounded-lg overflow-hidden text-sm">
        <thead class="bg-red-200 text-red-900">
          <tr>
            <th class="px-4 py-2">ID</th>
            <th class="px-4 py-2">Profile</th>
            <th class="px-4 py-2">Name</th>
            <th class="px-4 py-2">Email</th>
            <th class="px-4 py-2">Phone</th>
            <th class="px-4 py-2">Gender</th>
            <th class="px-4 py-2">DOB</th>
            <th class="px-4 py-2">City</th>
            <th class="px-4 py-2">Country</th>
            <th class="px-4 py-2">Date Joined</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody id="clientsTable">
          <!-- Client rows go here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Admins Tab -->
  <div id="adminsTab" class="user-tab hidden">
    <h2 class="text-xl font-bold mt-6 mb-2">Admins</h2>
    <button onclick="openModal('adminModal')" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded mb-4">+ Add Admin</button>
    <div class="overflow-x-auto">
      <table class="w-full bg-white shadow-md rounded-lg overflow-hidden text-sm">
        <thead class="bg-red-200 text-red-900">
          <tr>
            <th class="px-4 py-2">ID</th>
            <th class="px-4 py-2">Name</th>
            <th class="px-4 py-2">Email</th>
            <th class="px-4 py-2">Phone</th>
            <th class="px-4 py-2">Role</th>
            <th class="px-4 py-2">Date Joined</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody id="adminsTable">
          <!-- Admin rows go here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Trainer Modal -->
  <div id="trainerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg w-full max-w-4xl overflow-y-auto max-h-[90vh]">
      <h3 class="text-xl font-bold mb-4">Add/Edit Trainer</h3>
      <form id="trainerForm" class="grid grid-cols-1 md:grid-cols-2 gap-4" enctype="multipart/form-data">
        <input type="hidden" name="TrainerID" id="TrainerID">
        <input type="text" name="FullName" placeholder="Full Name" class="border p-2 rounded" required>
        <input type="email" name="Email" placeholder="Email" class="border p-2 rounded" required>
        <input type="password" name="Password" placeholder="Password" class="border p-2 rounded" required>
        <input type="text" name="Phone" placeholder="Phone" class="border p-2 rounded">
        <select name="Gender" class="border p-2 rounded">
          <option value="">Select Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Other</option>
        </select>
        <input type="date" name="DOB" placeholder="Date of Birth" class="border p-2 rounded">
        <input type="text" name="City" placeholder="City" class="border p-2 rounded">
        <input type="text" name="Country" placeholder="Country" class="border p-2 rounded">
        <textarea name="Address" placeholder="Address" class="border p-2 rounded col-span-2"></textarea>
        <input type="text" name="Qualifications" placeholder="Qualifications" class="border p-2 rounded">
        <input type="text" name="Expertise" placeholder="Expertise" class="border p-2 rounded">
        <input type="url" name="IntroVideoURL" placeholder="Intro Video URL" class="border p-2 rounded">
        <input type="text" name="CertTitle" placeholder="Certificate Title" class="border p-2 rounded">
        <input type="text" name="CertIssuer" placeholder="Certificate Issuer" class="border p-2 rounded">
        <input type="number" name="CertYear" placeholder="Certificate Year" class="border p-2 rounded" min="1900" max="2099" step="1">
        <input type="text" name="CertID" placeholder="Certificate ID" class="border p-2 rounded">
        <label class="col-span-2">Profile Picture:
          <input type="file" name="ProfilePic" class="border p-2 rounded w-full">
        </label>
        <label class="col-span-2">Certificate File:
          <input type="file" name="CertFile" class="border p-2 rounded w-full">
        </label>
        <div class="col-span-2 flex justify-end gap-2 mt-4">
          <button type="button" onclick="closeModal('trainerModal')" class="bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded">Cancel</button>
          <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Client Modal -->
  <div id="clientModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg w-full max-w-3xl overflow-y-auto max-h-[90vh]">
      <h3 class="text-xl font-bold mb-4">Add/Edit Client</h3>
      <form id="clientForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input type="hidden" name="ClientID" id="ClientID">
        <input type="text" name="FullName" placeholder="Full Name" class="border p-2 rounded" required>
        <input type="email" name="Email" placeholder="Email" class="border p-2 rounded" required>
        <input type="password" name="Password" placeholder="Password" class="border p-2 rounded" required>
        <input type="text" name="Phone" placeholder="Phone" class="border p-2 rounded">
        <select name="Gender" class="border p-2 rounded">
          <option value="">Select Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Other</option>
        </select>
        <input type="date" name="DOB" placeholder="Date of Birth" class="border p-2 rounded">
        <input type="text" name="City" placeholder="City" class="border p-2 rounded">
        <input type="text" name="Country" placeholder="Country" class="border p-2 rounded">
        <textarea name="Address" placeholder="Address" class="border p-2 rounded col-span-2"></textarea>
        <div class="col-span-2 flex justify-end gap-2 mt-4">
          <button type="button" onclick="closeModal('clientModal')" class="bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded">Cancel</button>
          <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Admin Modal -->
  <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg w-full max-w-2xl overflow-y-auto max-h-[90vh]">
      <h3 class="text-xl font-bold mb-4">Add/Edit Admin</h3>
      <form id="adminForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input type="hidden" name="AdminID" id="AdminID">
        <input type="text" name="FullName" placeholder="Full Name" class="border p-2 rounded" required>
        <input type="email" name="Email" placeholder="Email" class="border p-2 rounded" required>
        <input type="password" name="Password" placeholder="Password" class="border p-2 rounded" required>
        <input type="text" name="Phone" placeholder="Phone" class="border p-2 rounded">
        <select name="Role" class="border p-2 rounded">
          <option value="">Select Role</option>
          <option value="SuperAdmin">Super Admin</option>
          <option value="Admin">Admin</option>
        </select>
        <div class="col-span-2 flex justify-end gap-2 mt-4">
          <button type="button" onclick="closeModal('adminModal')" class="bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded">Cancel</button>
          <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Save</button>
        </div>
      </form>
    </div>
  </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
        function showTab(event, tab) {
      // Remove active styles from all tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('bg-red-500', 'text-white');
        btn.classList.add('bg-red-200', 'text-red-900');
      });
      event.target.classList.add('bg-red-500', 'text-white');
      event.target.classList.remove('bg-red-200', 'text-red-900');
      // Hide all user-tabs
      document.querySelectorAll('.user-tab').forEach(tabDiv => tabDiv.classList.add('hidden'));
      // Show selected tab
      document.getElementById(tab + 'Tab').classList.remove('hidden');
    }
    function openModal(modalId) {
    document.getElementById(modalId).classList.remove('hidden');
    }
    function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
    }
    window.onload = () => {
    ['trainer', 'client', 'admin'].forEach(role => loadUsers(role));
    };

    const endpoints = {
    trainer: '/manage/profile/trainers',
    client: '/manage/profile/clients',
    admin: '/manage/profile/admins'
    
    };

    async function loadUsers(role) {
    try {
        const response = await fetch(endpoints[role]);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const users = await response.json();

        const tbody = document.getElementById(`${role}sTable`);
        tbody.innerHTML = '';

        users.forEach(user => {
        const idKey = role === 'trainer' ? 'TrainerID' : role === 'client' ? 'ClientID' : 'AdminID';
        let row = '';

        if(role === 'trainer') {
            row = `
            <tr>
                <td class="border p-2">${user.TrainerID}</td>
                <td class="border p-2">
                <img src="/profile-pic/trainer/${user.TrainerID}" alt="Profile" class="w-12 h-12 rounded-full object-cover">
                </td>
                <td class="border p-2">${user.FullName}</td>
                <td class="border p-2">${user.Email}</td>
                <td class="border p-2">${user.Phone || ''}</td>
                <td class="border p-2">${user.Gender || ''}</td>
                <td class="border p-2">${user.DOB ? user.DOB.split('T')[0] : ''}</td>
                <td class="border p-2">${user.City || ''}</td>
                <td class="border p-2">${user.Country || ''}</td>
                <td class="border p-2">${user.Qualifications || ''}</td>
                <td class="border p-2">${user.Expertise || ''}</td>
                <td class="border p-2">${user.IntroVideoURL ? `<a href="${user.IntroVideoURL}" target="_blank">Link</a>` : ''}</td>
                <td class="border p-2">${user.CertTitle || ''}</td>
                <td class="border p-2">${user.CertIssuer || ''}</td>
                <td class="border p-2">${user.CertYear || ''}</td>
                <td class="border p-2">${user.CertID || ''}</td>
                <td class="border p-2">${user.DateJoined ? user.DateJoined.split('T')[0] : ''}</td>
                <td class="border p-2">
                <button onclick="editUser('trainer', ${user.TrainerID})" class="text-blue-600">Edit</button>
                <button onclick="deleteUser('trainer', ${user.TrainerID})" class="text-red-600">Delete</button>
                </td>
            </tr>`;
        }
        else if(role === 'client') {
            row = `
            <tr>
                <td class="border p-2">${user.ClientID}</td>
                <td class="border p-2">
                <img src="/profile-pic/client/${user.ClientID}" alt="Profile" class="w-12 h-12 rounded-full object-cover">
                </td>
                <td class="border p-2">${user.FullName}</td>
                <td class="border p-2">${user.Email}</td>
                <td class="border p-2">${user.Phone || ''}</td>
                <td class="border p-2">${user.Gender || ''}</td>
                <td class="border p-2">${user.DOB ? user.DOB.split('T')[0] : ''}</td>
                <td class="border p-2">${user.City || ''}</td>
                <td class="border p-2">${user.Country || ''}</td>
                <td class="border p-2">${user.DateJoined ? user.DateJoined.split('T')[0] : ''}</td>
                <td class="border p-2">
                <button onclick="editUser('client', ${user.ClientID})" class="text-blue-600">Edit</button>
                <button onclick="deleteUser('client', ${user.ClientID})" class="text-red-600">Delete</button>
                </td>
            </tr>`;
        }
        else if(role === 'admin') {
            row = `
            <tr>
                <td class="border p-2">${user.AdminID}</td>
                <td class="border p-2">${user.FullName}</td>
                <td class="border p-2">${user.Email}</td>
                <td class="border p-2">${user.Phone || ''}</td>
                <td class="border p-2">${user.Role || ''}</td>
                <td class="border p-2">${user.DateJoined ? user.DateJoined.split('T')[0] : ''}</td>
                <td class="border p-2">
                <button onclick="editUser('admin', ${user.AdminID})" class="text-blue-600">Edit</button>
                <button onclick="deleteUser('admin', ${user.AdminID})" class="text-red-600">Delete</button>
                </td>
            </tr>`;
        }

        tbody.innerHTML += row;
        });

    } catch (error) {
        console.error(`Failed to load ${role}s:`, error);
    }
    }
</script>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
async function editUser(role, id) {
    const { value: formValues } = await Swal.fire({
        title: `Edit ${role.charAt(0).toUpperCase() + role.slice(1)}`,
        html:
            `<input id="swal-input1" class="swal2-input" placeholder="New name">` +
            `<input id="swal-input2" class="swal2-input" placeholder="New email">` +
            `<input id="swal-input3" class="swal2-input" placeholder="New phone">`,
        focusConfirm: false,
        showCancelButton: true,
        preConfirm: () => {
            return {
                FullName: document.getElementById('swal-input1').value.trim(),
                Email: document.getElementById('swal-input2').value.trim(),
                Phone: document.getElementById('swal-input3').value.trim()
            };
        }
    });

    if (!formValues) return; // Cancel clicked

    const payload = {};
    if (formValues.FullName) payload.FullName = formValues.FullName;
    if (formValues.Email) payload.Email = formValues.Email;
    if (formValues.Phone) payload.Phone = formValues.Phone;

    if (Object.keys(payload).length === 0) {
        return Swal.fire('No changes', 'No fields were filled in.', 'info');
    }

    try {
        // Use singular role to match backend route
        const res = await fetch(`/manage/profile/${role}/${id}`, {
            method: 'PUT',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const result = await res.json();
        if (!res.ok) throw new Error(result.error || 'Update failed');

        await Swal.fire('✅ Updated!', `${role} updated successfully.`, 'success');
        loadUsers(role);
    } catch (err) {
        Swal.fire('❌ Error', err.message, 'error');
    }
}

async function deleteUser(role, id) {
    const confirmResult = await Swal.fire({
        title: `Delete ${role}?`,
        text: `Are you sure you want to delete this ${role}? This action cannot be undone.`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, delete it!',
        cancelButtonText: 'Cancel'
    });

    if (!confirmResult.isConfirmed) return;

    try {
        // Use singular role to match backend route
        const res = await fetch(`/manage/profile/${role}/${id}`, {
            method: 'DELETE',
            credentials: 'include'
        });

        const result = await res.json();
        if (!res.ok) throw new Error(result.error || 'Delete failed');

        await Swal.fire('✅ Deleted!', `${role} was deleted successfully.`, 'success');
        loadUsers(role);
    } catch (err) {
        Swal.fire('❌ Error', err.message, 'error');
    }
}
</script>

</body>
</html>
