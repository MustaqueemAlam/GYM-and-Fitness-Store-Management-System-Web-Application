<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>E-Fitness Trainer - Workout Plan & Exercise Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />
  </head>
  <body class="flex h-screen bg-gradient-to-r from-red-50 to-red-100">
    <aside
      class="w-64 bg-white border-r border-gray-200 p-5 flex flex-col justify-between"
    >
      <div>
        <a href="trainer-dashboard.html" class="block">
          <div
            class="flex items-center gap-3 mb-8 hover:opacity-80 transition"
          >
            <img
              src="https://cdn.pixabay.com/photo/2014/03/25/16/25/gym-297059_640.png"
              alt="Trainer Logo"
              class="w-10 h-10 rounded-full object-cover shadow-md"
            />
            <h2 class="text-2xl font-bold text-red-700">E-Fitness Trainer</h2>
          </div>
        </a>

        <nav class="flex flex-col space-y-3">
          <a
            href="trainer-reg-and-profile.html"
            class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-red-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 13l4 4L19 7"
              />
            </svg>
            Profile Management
          </a>
          <a
            href="trainer-Diet-Plan-Management.html"
            class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-red-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 17v-2a4 4 0 014-4h4"
              />
            </svg>
            Diet Plan Management
          </a>
          <a
            href="trainer-Workout-Plan-Management.html"
            class="flex items-center gap-3 text-red-600 font-medium transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-red-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 17v-2a4 4 0 014-4h4"
              />
            </svg>
            Workout Plan Management
          </a>
          <a
            href="trainer-client-management.html"
            class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-red-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 8h10M7 12h8m-8 4h6"
              />
            </svg>
            Client Overview & Management
          </a>
          <a
            href="trainer-attendance-monitor.html"
            class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-red-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 10l4.553 2.276a1 1 0 010 1.448L15 16m0-6v6m-6-6h.01M6 10h.01"
              />
            </svg>
            Attendance and Progress Monitoring
          </a>
          <a
            href="trainer-host-virtualclass.html"
            class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-red-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 10l4.553 2.276a1 1 0 010 1.448L15 16m0-6v6m-6-6h.01M6 10h.01"
              />
            </svg>
            Virtual Classes
          </a>
          <a
            href="trainer-feedback.html"
            class="flex items-center gap-3 text-gray-700 hover:text-red-600 font-medium transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-red-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 17h2M12 12v3m-1 0h2m-6 4h8a2 2 0 002-2v-6a2 2 0 00-2-2h-8a2 2 0 00-2 2v6a2 2 0 002 2z"
              />
            </svg>
            Feedback
          </a>
        </nav>
      </div>

      <button
        onclick="window.location.href='../login.html';"
        class="mt-10 bg-red-100 hover:bg-red-200 text-red-700 font-semibold py-2 px-4 rounded transition-colors self-start"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="inline w-5 h-5 mr-2 -mb-1"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1"
          />
        </svg>
        Logout
      </button>
    </aside>

    <main class="flex-1 p-6 flex flex-col gap-6 overflow-y-auto">
      <header class="flex justify-between items-center">
        <h1 class="text-3xl font-bold text-red-800">Welcome, Trainer</h1>
        <div class="flex items-center gap-4">
          <button
            id="notifBtn"
            onclick="window.location.href='trainer-noti.html';"
            class="relative text-gray-700 hover:text-red-600"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 17h5l-1.405-1.405M19 13v-3a7 7 0 10-14 0v3l-1.405 1.405M13 21h-2"
              />
            </svg>
            <span
              class="absolute top-0 right-0 inline-block w-2 h-2 bg-red-600 rounded-full"
            ></span>
          </button>
        </div>
      </header>

      <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-2xl font-bold text-red-700 mb-4">Client Fitness Goals</h2>

        <div class="mb-6 flex justify-between items-center">
          <input
            id="searchInput"
            type="number"
            placeholder="Search by Client ID..."
            class="border p-2 rounded-md w-1/3 focus:outline-none focus:ring-2 focus:ring-red-300"
          />
          <button
            onclick="openAddGoalModal()"
            class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700"
          >
            Send New Goal (Global)
          </button>
        </div>

        <div id="clientsGoalsContainer" class="flex flex-col gap-4">
          <div class="flex-1 bg-white p-4 rounded-lg shadow-sm border border-gray-200">
            <h3 class="text-xl font-bold text-red-600 mb-4">Male Clients</h3>
            <div id="maleClientsGoals" class="flex flex-col gap-4">
            </div>
          </div>

          <div class="flex-1 bg-white p-4 rounded-lg shadow-sm border border-gray-200">
            <h3 class="text-xl font-bold text-red-600 mb-4">Female Clients</h3>
            <div id="femaleClientsGoals" class="flex flex-col gap-4">
            </div>
          </div>
        </div>
      </div>

      <div
        id="clientModal"
        class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50 p-4"
      >
        <div
          class="bg-white rounded-xl shadow-2xl w-full max-w-2xl p-8 relative transform transition-all scale-100 opacity-100"
        >
          <button
            onclick="closeModal()"
            class="absolute top-4 right-4 text-gray-500 hover:text-red-600 text-3xl font-semibold leading-none"
          >
            &times;
          </button>

          <h2 class="text-3xl font-bold text-red-700 mb-6 border-b pb-3">
            Client Profile
          </h2>

          <div class="flex flex-col md:flex-row items-center md:items-start gap-8">
            <div class="flex-shrink-0">
              <img
                id="modalProfilePic"
                src="https://via.placeholder.com/150"
                alt="Profile Picture"
                class="w-32 h-32 rounded-full object-cover border-4 border-red-200 shadow-md"
              />
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-3 text-lg flex-grow">
              <p><strong>Client ID:</strong> <span id="modalClientID" class="text-gray-700"></span></p>
              <p><strong>Full Name:</strong> <span id="modalFullName" class="text-gray-700"></span></p>
              <p><strong>Email:</strong> <span id="modalEmail" class="text-gray-700"></span></p>
              <p><strong>Phone:</strong> <span id="modalPhone" class="text-gray-700"></span></p>
              <p><strong>Gender:</strong> <span id="modalGender" class="text-gray-700"></span></p>
              <p><strong>Date of Birth:</strong> <span id="modalDOB" class="text-gray-700"></span></p>
              <p class="col-span-1 sm:col-span-2">
                <strong>Address:</strong> <span id="modalAddress" class="text-gray-700"></span>
              </p>
              <p><strong>City:</strong> <span id="modalCity" class="text-gray-700"></span></p>
              <p><strong>Country:</strong> <span id="modalCountry" class="text-gray-700"></span></p>
              <p><strong>Date Joined:</strong> <span id="modalDateJoined" class="text-gray-700"></span></p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      let allClients = []; // all data loaded on page load

      // Define your base URL for profile pictures.
      // IMPORTANT: Replace this with the actual base URL where your client profile pictures are stored.
      // If your backend already returns full absolute URLs, you can set this to an empty string or null.
      const BASE_PROFILE_PIC_URL = 'http://localhost:3000'; // Example: 'https://yourdomain.com/uploads/profile_pics' or 'http://yourbackend.com'

      // Fetch all clients + goals once
      async function fetchAllGoals() {
        try {
          const res = await fetch('/trainer/goals', { credentials: 'include' });
          const json = await res.json();

          if (!json.success) {
            Swal.fire('Error', json.message, 'error');
            return;
          }

          allClients = json.data;
          displayGoals(allClients);
        } catch (err) {
          console.error(err);
          Swal.fire('Error', 'Failed to fetch goals.', 'error');
        }
      }

      // Display filtered clients + goals
      function displayGoals(clients) {
        const maleContainer = document.getElementById('maleClientsGoals');
        const femaleContainer = document.getElementById('femaleClientsGoals');
        maleContainer.innerHTML = '';
        femaleContainer.innerHTML = '';

        if (clients.length === 0) {
          maleContainer.innerHTML = `<p class="text-center text-gray-500 col-span-full">No male clients or goals found.</p>`;
          femaleContainer.innerHTML = `<p class="text-center text-gray-500 col-span-full">No female clients or goals found.</p>`;
          return;
        }

        clients.forEach((client) => {
          const clientCard = document.createElement('div');
          clientCard.className = 'bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200';
          clientCard.id = `client-${client.ClientID}`;

          const hasGoals = client.goals && client.goals.length > 0;
          const defaultProfilePic = 'https://via.placeholder.com/100'; // Default placeholder

          // Construct the image source URL.
          // If client.ProfilePic is a relative path, prepend BASE_PROFILE_PIC_URL.
          // If client.ProfilePic is already a full URL, this concatenation will still work.
          const profilePicSrc = client.ProfilePic
            ? BASE_PROFILE_PIC_URL + client.ProfilePic // This line is fixed
            : defaultProfilePic;


          clientCard.innerHTML = `
            <div class="flex items-center justify-between cursor-pointer py-2" >
                <div class="flex items-center gap-3" onclick="toggleGoalsVisibility(${client.ClientID})">
                    <img src="${profilePicSrc}" alt="Profile Picture" class="w-16 h-16 rounded-full object-cover border-2 border-red-300">
                    <div>
                        <h3 class="text-xl font-semibold text-red-700">
                            ${client.FullName || 'N/A'}
                            <span class="text-gray-500 text-sm">(ID: ${client.ClientID})</span>
                        </h3>
                        <p class="text-gray-600">${client.Email || 'N/A'}</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="openAddGoalModal(${
                      client.ClientID
                    })" class="bg-blue-500 text-white px-3 py-1 rounded-md hover:bg-blue-600 text-sm">
                        Send Goal
                    </button>
                    <button class="text-gray-500 hover:text-red-600 focus:outline-none" onclick="toggleGoalsVisibility(${
                      client.ClientID
                    })">
                        <svg class="w-6 h-6 transform transition-transform" id="arrow-${
                          client.ClientID
                        }" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                </div>
            </div>
            <div id="goals-${client.ClientID}" class="mt-4 overflow-x-auto hidden">
                ${
                  hasGoals
                    ? `
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-red-100 text-red-800">
                            <tr>
                                <th class="px-4 py-2 text-left">Goal</th>
                                <th class="px-4 py-2 text-left">Description</th>
                                <th class="px-4 py-2 text-left">Target Date</th>
                                <th class="px-4 py-2 text-left">Progress</th>
                                <th class="px-4 py-2 text-left">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-100 text-sm">
                            ${client.goals
                              .map(
                                (goal) => `
                                <tr>
                                    <td class="px-4 py-2">${goal.GoalTitle}</td>
                                    <td class="px-4 py-2">${
                                      goal.GoalDescription || '-'
                                    }</td>
                                    <td class="px-4 py-2">${
                                      goal.TargetDate
                                        ? new Date(
                                              goal.TargetDate,
                                            ).toLocaleDateString()
                                        : '-'
                                    }</td>
                                    <td class="px-4 py-2">
                                        ${
                                          goal.IsAchieved === 1
                                            ? `<span class="text-green-600 font-semibold">Completed</span>`
                                            : `<div class="w-full bg-gray-200 rounded-full h-4">
                                                    <div class="bg-yellow-400 h-4 rounded-full animate-pulse" style="width: 100%"></div>
                                                </div>`
                                        }
                                    </td>
                                    <td class="px-4 py-2">
                                        <button class="text-blue-600 hover:underline" onclick="editGoal(${
                                          goal.GoalID
                                        })">Edit</button>
                                        <button class="text-red-600 hover:underline ml-2" onclick="deleteGoal(${
                                          goal.GoalID
                                        })">Delete</button>
                                    </td>
                                </tr>
                                `,
                              )
                              .join('')}
                        </tbody>
                    </table>`
                    : `<p class="px-4 py-2 text-center text-gray-500">No goals set for this client.</p>`
                }
                <div class="text-right mt-4">
                    <button onclick="openClientModal(${client.ClientID})" class="text-sm bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600">View Client Details</button>
                </div>
            </div>
          `;
          if (client.Gender && client.Gender.toLowerCase() === 'male') {
            maleContainer.appendChild(clientCard);
          } else if (client.Gender && client.Gender.toLowerCase() === 'female') {
            femaleContainer.appendChild(clientCard);
          }
        });

        if (maleContainer.children.length === 0) {
            maleContainer.innerHTML = `<p class="text-center text-gray-500">No male clients or goals found.</p>`;
        }
        if (femaleContainer.children.length === 0) {
            femaleContainer.innerHTML = `<p class="text-center text-gray-500">No female clients or goals found.</p>`;
        }
      }

      function toggleGoalsVisibility(clientId) {
        const goalsDiv = document.getElementById(`goals-${clientId}`);
        const arrowIcon = document.getElementById(`arrow-${clientId}`);
        if (goalsDiv.classList.contains('hidden')) {
          goalsDiv.classList.remove('hidden');
          arrowIcon.classList.add('rotate-180');
        } else {
          goalsDiv.classList.add('hidden');
          arrowIcon.classList.remove('rotate-180');
        }
      }

      // Live search filter by ClientID
      document.getElementById('searchInput').addEventListener('input', function () {
        const filterVal = this.value.trim();

        if (filterVal === '') {
          displayGoals(allClients);
          return;
        }

        // Filter clients by ClientID startsWith or equals (number)
        const filtered = allClients.filter((client) =>
          client.ClientID.toString().startsWith(filterVal),
        );
        displayGoals(filtered);
      });

      // Open modal with client details (professionally designed)
      function openClientModal(clientId) {
        const client = allClients.find((c) => c.ClientID === clientId);
        if (!client) {
          Swal.fire('Error', 'Client not found.', 'error');
          return;
        }

        const defaultProfilePic = 'https://via.placeholder.com/150'; // Larger default placeholder

        // Construct the image source URL for the modal.
        // If client.ProfilePic is a relative path, prepend BASE_PROFILE_PIC_URL.
        const modalProfilePicSrc = client.ProfilePic
          ? BASE_PROFILE_PIC_URL + client.ProfilePic // This line is fixed
          : defaultProfilePic;

        document.getElementById('modalProfilePic').src = modalProfilePicSrc;
        document.getElementById('modalClientID').textContent = client.ClientID || 'N/A';
        document.getElementById('modalFullName').textContent =
          client.FullName || 'N/A';
        document.getElementById('modalEmail').textContent = client.Email || 'N/A';
        document.getElementById('modalPhone').textContent = client.Phone || 'N/A';
        document.getElementById('modalGender').textContent = client.Gender || 'N/A';
        document.getElementById('modalDOB').textContent = client.DOB
          ? new Date(client.DOB).toLocaleDateString()
          : 'N/A';
        document.getElementById('modalAddress').textContent =
          client.Address || 'N/A';
        document.getElementById('modalCity').textContent = client.City || 'N/A';
        document.getElementById('modalCountry').textContent =
          client.Country || 'N/A';
        document.getElementById('modalDateJoined').textContent = client.DateJoined
          ? new Date(client.DateJoined).toLocaleDateString()
          : 'N/A';

        document.getElementById('clientModal').classList.remove('hidden');
        document.getElementById('clientModal').classList.add('flex');
      }

      function closeModal() {
        document.getElementById('clientModal').classList.add('hidden');
        document.getElementById('clientModal').classList.remove('flex');
      }

      async function editGoal(goalId) {
        const goal = allClients
          .flatMap((c) => c.goals)
          .find((g) => g.GoalID === goalId);
        if (!goal) return Swal.fire('Error', 'Goal not found', 'error');

        const { value: formValues } = await Swal.fire({
          title: 'Edit Goal',
          html:
            `<input id="swal-title" class="swal2-input" placeholder="Title" value="${
              goal.GoalTitle || ''
            }">` +
            `<textarea id="swal-desc" class="swal2-textarea" placeholder="Description">${
              goal.GoalDescription || ''
            }</textarea>` +
            `<input id="swal-start" type="date" class="swal2-input" value="${
              goal.TargetDate?.split('T')[0] || ''
            }">` +
            `<label style="display:block;margin-top:10px;">Is Achieved?</label>` +
            `<select id="swal-achieved" class="swal2-input">
                <option value="0" ${goal.IsAchieved == 0 ? 'selected' : ''}>No</option>
                <option value="1" ${goal.IsAchieved == 1 ? 'selected' : ''}>Yes</option>
            </select>`,
          focusConfirm: false,
          showCancelButton: true, // Add cancel button
          confirmButtonText: 'Save Changes',
          cancelButtonText: 'Cancel',
          preConfirm: () => {
            const title = document.getElementById('swal-title').value;
            const date = document.getElementById('swal-start').value;

            if (!title) {
              Swal.showValidationMessage('Goal Title cannot be empty.');
              return false;
            }
            if (!date) {
              Swal.showValidationMessage('Target Date cannot be empty.');
              return false;
            }
            if (new Date(date) < new Date()) {
              Swal.showValidationMessage('Target Date cannot be in the past.');
              return false;
            }

            return {
              GoalTitle: title,
              GoalDescription: document.getElementById('swal-desc').value,
              TargetDate: date,
              IsAchieved: parseInt(document.getElementById('swal-achieved').value),
            };
          },
        });

        if (!formValues) return; // User clicked cancel or dismissed

        try {
          const res = await fetch(`/trainer/goals/${goalId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify(formValues),
          });

          const result = await res.json();
          if (result.success) {
            Swal.fire('Updated!', result.message, 'success');
            fetchAllGoals();
          } else {
            Swal.fire('Error', result.message, 'error');
          }
        } catch (err) {
          console.error(err);
          Swal.fire('Error', 'Failed to update goal', 'error');
        }
      }

      async function deleteGoal(goalId) {
        const confirmResult = await Swal.fire({
          title: 'Are you sure?',
          text: 'This goal will be permanently deleted!',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, delete it!',
          cancelButtonText: 'Cancel',
        });

        if (!confirmResult.isConfirmed) return;

        try {
          const res = await fetch(`/trainer/goals/${goalId}`, {
            method: 'DELETE',
            credentials: 'include',
          });

          const result = await res.json();
          if (result.success) {
            Swal.fire('Deleted!', result.message, 'success');
            fetchAllGoals();
          } else {
            Swal.fire('Error', result.message, 'error');
          }
        } catch (err) {
          console.error(err);
          Swal.fire('Error', 'Failed to delete goal', 'error');
        }
      }

      async function openAddGoalModal(clientId = null) {
        const { value: formValues } = await Swal.fire({
          title: 'Send New Goal',
          html:
            `<input id="swal-client" type="number" class="swal2-input" placeholder="Client ID" value="${
              clientId || ''
            }" ${clientId ? 'readonly' : ''}>` + // Pre-fill if clientId is provided
            `<input id="swal-title" class="swal2-input" placeholder="Goal Title">` +
            `<textarea id="swal-desc" class="swal2-textarea" placeholder="Goal Description"></textarea>` +
            `<input id="swal-date" type="date" class="swal2-input" placeholder="Target Date">`,
          focusConfirm: false,
          showCancelButton: true, // Add cancel button
          confirmButtonText: 'Send Goal',
          cancelButtonText: 'Cancel',
          preConfirm: () => {
            const clientID = parseInt(document.getElementById('swal-client').value);
            const title = document.getElementById('swal-title').value;
            const date = document.getElementById('swal-date').value;

            if (isNaN(clientID) || clientID <= 0) {
              Swal.showValidationMessage('Please enter a valid Client ID.');
              return false;
            }
            if (!title.trim()) {
              Swal.showValidationMessage('Goal Title cannot be empty.');
              return false;
            }
            if (!date) {
              Swal.showValidationMessage('Target Date cannot be empty.');
              return false;
            }
            if (new Date(date) < new Date()) {
              Swal.showValidationMessage('Target Date cannot be in the past.');
              return false;
            }

            return {
              ClientID: clientID,
              GoalTitle: title,
              GoalDescription: document.getElementById('swal-desc').value,
              TargetDate: date,
              IsAchieved: 0,
            };
          },
        });

        if (!formValues) return; // User clicked cancel or dismissed

        try {
          const res = await fetch('/trainer/new/goals', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify(formValues),
          });

          const result = await res.json();
          if (result.success) {
            Swal.fire('Success', result.message, 'success');
            fetchAllGoals();
          } else {
            Swal.fire('Error', result.message, 'error');
          }
        } catch (err) {
          console.error(err);
          Swal.fire('Error', 'Failed to send goal', 'error');
        }
      }

      window.addEventListener('DOMContentLoaded', fetchAllGoals);
    </script>
  </body>
</html>